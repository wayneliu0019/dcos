FROM arm64v8/alpine:3.5
MAINTAINER help@dcos.io

WORKDIR /
RUN apk add --update curl ca-certificates git openssh openssl tar xz zlib && rm -rf /var/cache/apk/*

RUN curl  -fLsS --retry 20 -Y 100000 -y 60 -o glibc-bin-2.23.tar.gz https://wayne-apac.s3-us-west-2.amazonaws.com/arm64/glibc/glibc-bin-2.23.tar.gz && tar -xvf glibc-bin-2.23.tar.gz && ln -s /usr/glibc-compat/lib/ld-linux-aarch64.so.1 /lib/ld-linux-aarch64.so.1 

VOLUME ["/genconf"]

EXPOSE 9000
ENTRYPOINT ["/installer_internal_wrapper"]

# Add the mutable artifacts last to increase caching, starting with the common one
ADD {installer_bootstrap_filename} /opt/mesosphere/
COPY installer_internal_wrapper /installer_internal_wrapper
# TODO(cmaloney): Switch to copying across a whole artifacts directory
COPY {bootstrap_filename} /artifacts/bootstrap/{bootstrap_filename}
COPY {packages_dir} /artifacts/packages
COPY {bootstrap_active_filename} /artifacts/bootstrap/{bootstrap_active_filename}
COPY {bootstrap_latest_filename} /artifacts/bootstrap/{bootstrap_latest_filename}
COPY {latest_complete_filename} /artifacts/complete/{latest_complete_filename}
COPY gen_extra/ /gen_extra
